---
milestone: 1.1
audited: 2026-02-18T23:00:00Z
status: tech_debt
scores:
  requirements: 15/15
  phases: 4/4 (+ 1 paused)
  integration: 13/15 connections verified clean
  flows: 2/3 complete (1 degraded)
gaps:
  requirements: []
  integration:
    - id: "INT-01"
      from: "Phase 8 (rag.server.ts)"
      to: "Phase 7 (document_sections)"
      issue: "d.heading field mismatch — RPC returns section_title but RAG maps d.heading (undefined)"
      affected_requirements: ["SRCH-04"]
      severity: "non-critical"
      fix: "Change rag.server.ts line ~1111 from heading: d.heading to heading: d.section_title"
    - id: "INT-02"
      from: "Phase 9 (profiling.ts)"
      to: "missing table"
      issue: "getCouncillorHighlights queries non-existent councillor_highlights table — dead code path"
      affected_requirements: []
      severity: "non-critical"
      fix: "Remove dead code or create councillor_highlights migration"
  flows:
    - id: "FLOW-01"
      flow: "Document section RAG citations"
      breaks_at: "rag.server.ts search_document_sections result mapping"
      issue: "Section heading silently undefined; citation falls back to document title instead of section heading"
      affected_requirements: ["SRCH-04"]
tech_debt:
  - phase: "07.1"
    items:
      - "Phase paused at 2/3 plans — Gemini Batch API extraction waiting on batch API availability"
      - "extracted_documents, document_sections, document_images tables empty (wiped after 5-meeting test)"
  - phase: "08"
    items:
      - "gemini-flash-latest model name in api.search.tsx:168 — non-standard identifier, follow-up generation silently fails if unrecognized"
      - "SRCH-03 not listed in any SUMMARY frontmatter requirements-completed (oversight)"
      - "d.heading field mismatch in rag.server.ts — RAG citations show document title instead of section heading"
  - phase: "09"
    items:
      - "getCouncillorHighlights dead code path — queries non-existent councillor_highlights table"
  - phase: "10"
    items:
      - "document_chunker.py (Phase 7 core module) has no dedicated test file"
      - "hybrid-search.server.ts, profiling.ts, compare.tsx have no web test coverage"
  - phase: "admin"
    items:
      - "REQUIREMENTS.md has 6 unchecked boxes (DOC-01 through DOC-05, SRCH-03) that should be marked [x]"
---

# v1.1 Deep Intelligence — Milestone Audit

**Audited:** 2026-02-18
**Status:** TECH_DEBT — all requirements met, no critical blockers, accumulated deferred items

## Requirements Coverage (15/15)

### 3-Source Cross-Reference

| REQ-ID | Description | VERIFICATION | SUMMARY Frontmatter | REQUIREMENTS.md | Final Status |
|--------|-------------|-------------|---------------------|-----------------|--------------|
| DOC-01 | Pipeline chunks PDFs into sections | Phase 7: SATISFIED | 07-01, 07.1-01, 07.1-02 | `[ ]` Pending | **satisfied** (checkbox needs update) |
| DOC-02 | Sections stored with halfvec(384) embeddings | Phase 7: SATISFIED | 07-01, 07.1-01 | `[ ]` Pending | **satisfied** (checkbox needs update) |
| DOC-03 | Sections have tsvector FTS indexes | Phase 7: SATISFIED | 07-01, 07-03, 07.1-01 | `[ ]` Pending | **satisfied** (checkbox needs update) |
| DOC-04 | Sections linked to agenda items | Phase 7: SATISFIED | 07-01, 07.1-01, 07.1-02 | `[ ]` Pending | **satisfied** (checkbox needs update) |
| DOC-05 | Existing documents backfilled | Phase 7: SATISFIED | 07-02 | `[ ]` Pending | **satisfied** (checkbox needs update) |
| SRCH-01 | Unified search page | Phase 8: SATISFIED | 08-03, 08-04 | `[x]` Complete | **satisfied** |
| SRCH-02 | Intent detection (keyword vs question) | Phase 8: SATISFIED | 08-02, 08-03 | `[x]` Complete | **satisfied** |
| SRCH-03 | Hybrid search RPC with RRF | Phase 8: SATISFIED (DB confirmed) | not listed | `[ ]` Pending | **satisfied** (DB confirmed via MCP; checkbox needs update) |
| SRCH-04 | Search covers all 4 content types | Phase 8: SATISFIED | 08-02 | `[x]` Complete | **satisfied** (note: RAG citation heading degraded) |
| SRCH-05 | Follow-up questions with context | Phase 8: SATISFIED | 08-04 | `[x]` Complete | **satisfied** |
| SRCH-06 | Conversation history, 5 turn limit | Phase 8: SATISFIED | 08-04 | `[x]` Complete | **satisfied** |
| PROF-02 | Speaking time metrics | Phase 9: SATISFIED | 09-01, 09-03 | `[x]` Complete | **satisfied** |
| PROF-04 | AI stance summaries per topic | Phase 9: SATISFIED | 09-01, 09-02, 09-03 | `[x]` Complete | **satisfied** |
| PROF-05 | Confidence scoring + evidence links | Phase 9: SATISFIED | 09-02, 09-03 | `[x]` Complete | **satisfied** |
| PROF-06 | Side-by-side councillor comparison | Phase 9: SATISFIED | 09-04 | `[x]` Complete | **satisfied** |

**Orphaned requirements:** None. All 15 v1.1 REQ-IDs appear in at least one phase VERIFICATION.md.

### DB Verification (performed during audit)

| Check | Query | Result |
|-------|-------|--------|
| Hybrid search RPCs | `SELECT proname FROM pg_proc WHERE proname LIKE 'hybrid_search_%'` | 3 rows: hybrid_search_document_sections, hybrid_search_key_statements, hybrid_search_motions |
| key_statements.text_search | `SELECT column_name FROM information_schema.columns WHERE table_name = 'key_statements' AND column_name = 'text_search'` | 1 row confirmed |
| search_results_cache table | `SELECT tablename FROM pg_tables WHERE tablename = 'search_results_cache'` | 1 row confirmed |

## Phase Verification Summary

| Phase | Status | Score | Gaps | Tech Debt |
|-------|--------|-------|------|-----------|
| 7: Document Intelligence | PASSED | 11/11 | None | None |
| 7.1: Upgrade Extraction | PAUSED (no VERIFICATION) | 2/3 plans | Not blocking — DOC reqs satisfied by Phase 7 | Batch API backfill pending |
| 8: Unified Search & Hybrid RAG | PASSED (DB confirmed) | 9/10 → 10/10 | SRCH-03 now confirmed | gemini-flash-latest model name |
| 9: AI Profiling & Comparison | PASSED | 12/12 | None | councillor_highlights dead code |
| 10: Test Suite | PASSED | 16/16 | None | Coverage gaps in Phase 7-9 modules |

## Cross-Phase Integration

### Verified Connections (13 clean)

| From | To | Via | Status |
|------|----|-----|--------|
| Phase 7 document_sections | Phase 8 hybrid_search_document_sections RPC | `hybrid-search.server.ts` calls RPC | WIRED |
| Phase 7 DocumentSections.tsx | meeting-detail.tsx | import + render in AgendaOverview | WIRED |
| Phase 7 document_sections | Phase 8 RAG agent | `search_document_sections` tool in rag.server.ts | WIRED (heading degraded) |
| Phase 8 /search route | Phase 8 /api/search | EventSource + fetch | WIRED |
| Phase 8 intent.ts | api.search.tsx + search.tsx | classifyIntent import | WIRED |
| Phase 8 /ask redirect | /search | 301 redirect | WIRED |
| Phase 9 profiling.ts | person-profile.tsx | 4 parallel loader queries | WIRED |
| Phase 9 StanceSummary | StanceSpectrum + topic-utils | component composition | WIRED |
| Phase 9 compare.tsx | profiling.ts + people.ts | loader imports | WIRED |
| Phase 9 Compare button | /compare route | Link in person-profile.tsx | WIRED |
| Phase 10 pipeline tests | Phase 7-9 modules | import + mock | WIRED |
| Phase 10 web tests | Phase 8 intent.ts | vitest import | WIRED |
| Phase 10 pre-deploy | both test suites | scripts/pre-deploy.sh | WIRED |

### Integration Issues (2 non-critical)

**INT-01: RAG document section heading mismatch** (affects SRCH-04)
- `rag.server.ts` line ~1111 maps `heading: d.heading` but the `hybrid_search_document_sections` RPC returns `section_title`
- Result: `heading` is always `undefined`; citation falls back to document title instead of section heading
- Impact: RAG answer citations show generic document title rather than specific section heading
- Fix: Change `heading: d.heading` to `heading: d.section_title` in rag.server.ts

**INT-02: Dead councillor_highlights code path**
- `profiling.ts:167-182` exports `getCouncillorHighlights` querying non-existent `councillor_highlights` table
- Called in `person-profile.tsx` with `.catch()` guard — silently returns `null`
- Impact: Highlights section in profile page never renders (invisible to users)
- Fix: Remove dead code or create the migration

## E2E User Flows

| Flow | Status | Details |
|------|--------|---------|
| Document ingestion → section display → search | COMPLETE | Sections created by chunker, displayed as accordions on meeting pages, discoverable via hybrid search |
| Search → AI answer → follow-up | COMPLETE | Intent detection routes query; AI streams answer with citations; follow-up preserves 5-turn conversation context |
| Document section RAG citations | DEGRADED | Search finds sections correctly, but AI answer citations show document title instead of section heading (INT-01) |
| Profile → stances → comparison | COMPLETE | Speaking time + stance summaries on profile page; Compare button navigates to /compare; side-by-side with alignment score |

## Accumulated Tech Debt

### Phase 7.1 (Paused)
- Gemini Batch API extraction paused at 2/3 plans — waiting on batch API availability
- extracted_documents, document_sections, document_images tables empty (wiped after 5-meeting test)

### Phase 8
- `gemini-flash-latest` model identifier in `api.search.tsx:168` — may silently fail follow-up generation
- SRCH-03 not listed in any SUMMARY frontmatter (oversight)
- `d.heading` field mismatch in `rag.server.ts` — RAG citations show document title instead of section heading

### Phase 9
- `getCouncillorHighlights` dead code path queries non-existent `councillor_highlights` table

### Phase 10
- `document_chunker.py` (Phase 7 core chunking module) has no dedicated test file
- `hybrid-search.server.ts`, `profiling.ts`, `compare.tsx` have no web test coverage

### Administrative
- REQUIREMENTS.md has 6 unchecked boxes (DOC-01 through DOC-05, SRCH-03) that should be marked `[x]`

**Total: 10 items across 5 categories**

---

_Audited: 2026-02-18_
_Auditor: Claude (gsd-audit-milestone)_
