# Requirements Archive: v1.0 Land & Launch

**Archived:** 2026-02-17
**Status:** SHIPPED
**Coverage:** 29/29 requirements satisfied (100%)

---

# Requirements: ViewRoyal.ai — Land & Launch Milestone

**Defined:** 2026-02-16
**Core Value:** Citizens can understand what their council decided, why, and who said what — without attending meetings or reading hundreds of pages of PDFs.

## v1 Requirements — All Complete

### Schema Stabilization (6/6)

- [x] **SCHEMA-01**: Embedding dimension mismatch fixed — query embeddings generate halfvec(384) matching stored embeddings
- [x] **SCHEMA-02**: Missing `match_transcript_segments` RPC function restored — replaced with tsvector FTS in rag.server.ts
- [x] **SCHEMA-03**: All 23 applied migrations validated against PR migration SQL — no duplicate/conflicting migrations on merge
- [x] **SCHEMA-04**: PR #35 (embedding migration) merged to main without schema conflicts

### Key Statement Extraction (2/2)

- [x] **KS-01**: Key statement extraction prompts improved per PR #37 fixes — max 6 per item, unique timestamps, single-speaker
- [x] **KS-02**: PR #37 merged to main after PR #35

### Multi-Tenancy (6/6)

- [x] **MT-01**: Municipality context loaded in root loader from `municipalities` table
- [x] **MT-02**: All hardcoded "View Royal" strings replaced with dynamic municipality data — remaining are fallback defaults
- [x] **MT-03**: Service queries accept and filter by `municipality_id`
- [x] **MT-04**: RAG system prompts dynamically reference municipality name
- [x] **MT-05**: Vimeo proxy uses dynamic `websiteUrl` for Referer/Origin
- [x] **MT-06**: PR #36 merged to main after PRs #35 and #37

### Subscriptions & Notifications (12/12)

- [x] **SUB-01**: User can subscribe to a specific matter and receive email when it has new activity
- [x] **SUB-02**: User can subscribe to a specific councillor and receive email on their motions/votes
- [x] **SUB-03**: User can subscribe to a topic/category and receive email on matching items
- [x] **SUB-04**: User can subscribe to a neighbourhood and receive email on geographically relevant items
- [x] **SUB-05**: User can subscribe to weekly meeting digest email — personalized with Following badges
- [x] **SUB-06**: User can manage subscription preferences (frequency, channels, unsubscribe) from settings page
- [x] **SUB-07**: Email delivery works via Resend through Supabase Edge Function — needs RESEND_API_KEY config
- [x] **SUB-08**: `user_profiles` table exists with address, neighbourhood, notification preferences
- [x] **SUB-09**: `subscriptions` table supports polymorphic subscription types (matter, topic, person, neighbourhood, digest)
- [x] **SUB-10**: `alert_log` table tracks sent alerts with deduplication
- [x] **SUB-11**: Public user signup available — needs Auth dashboard toggle
- [x] **SUB-12**: PR #13 merged to main after PR #36, with necessary adaptations for multi-tenancy context

### Home Page Enhancements (5/5)

- [x] **HOME-01**: Active matters section shows 6 recently-active matters ordered by `last_seen` with title, category badge, duration, and 1-line summary
- [x] **HOME-02**: Recent decisions feed shows last 10+ non-procedural motions with plain English summary, result, vote breakdown, date, and link to meeting
- [x] **HOME-03**: Upcoming meetings section shows next scheduled meetings with agenda topic preview
- [x] **HOME-04**: Divided votes highlighted with visual indicator in decisions feed — amber border + "Divided" badge + controversial toggle
- [x] **HOME-05**: Financial cost displayed on decisions when `financial_cost` is available

## Traceability — Final Status

| Requirement | Phase | Status |
|-------------|-------|--------|
| SCHEMA-01 | Phase 1 | Satisfied |
| SCHEMA-02 | Phase 1 | Satisfied |
| SCHEMA-03 | Phase 1 | Satisfied |
| SCHEMA-04 | Phase 1 | Satisfied |
| KS-01 | Phase 1 | Satisfied |
| KS-02 | Phase 1 | Satisfied |
| MT-01 | Phase 2 | Satisfied |
| MT-02 | Phase 2 | Satisfied |
| MT-03 | Phase 2 | Satisfied |
| MT-04 | Phase 2 | Satisfied |
| MT-05 | Phase 2 | Satisfied |
| MT-06 | Phase 2 | Satisfied |
| SUB-01 | Phase 3 | Satisfied |
| SUB-02 | Phase 3 | Satisfied |
| SUB-03 | Phase 5 | Satisfied |
| SUB-04 | Phase 5 | Satisfied |
| SUB-05 | Phase 5 | Satisfied |
| SUB-06 | Phase 3 | Satisfied |
| SUB-07 | Phase 3 | Satisfied |
| SUB-08 | Phase 3 | Satisfied |
| SUB-09 | Phase 3 | Satisfied |
| SUB-10 | Phase 3 | Satisfied |
| SUB-11 | Phase 3 | Satisfied |
| SUB-12 | Phase 3 | Satisfied |
| HOME-01 | Phase 4 + 6 | Satisfied |
| HOME-02 | Phase 4 + 6 | Satisfied |
| HOME-03 | Phase 4 | Satisfied |
| HOME-04 | Phase 4 | Satisfied |
| HOME-05 | Phase 4 | Satisfied |

## Changed Requirements

- **SCHEMA-02**: Originally "restore match_transcript_segments RPC" — solution was tsvector FTS replacement instead
- **HOME-01**: Originally "5-6 matters" — Phase 4 shipped 4, Phase 6 corrected to 6
- **HOME-02**: Originally "10-15 motions" — Phase 4 shipped 8, Phase 6 corrected to 10+

---
*Requirements defined: 2026-02-16*
*Archived: 2026-02-17 after v1.0 milestone completion*
