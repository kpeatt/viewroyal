---
phase: 07.1-upgrade-document-extraction-with-docling-and-gemini
task: 2
total_tasks: 2
status: blocked
last_updated: 2026-02-18T20:05:27.283Z
---

<current_state>
Phase 7.1 Plan 03 (backfill + verification). Task 1 (CLI) done. Task 2 (human-verify gate) blocked on Gemini API quota.

308 meetings still need Gemini extraction. Progress file has been reset to allow re-processing.
DB is clean: 40,805 Gemini sections, zero legacy sections, zero orphans.

Document viewer UI refactored into index + detail routes and deployed.
</current_state>

<completed_work>

**This session:**
- Verified Gemini API still blocked (429 RESOURCE_EXHAUSTED, limit: 0 — not temporary rate limit, quota is literally 0)
- Investigated DB vs progress file mismatch: progress file had 712 "done" but only 404 meetings actually have extracted_documents
- Reset backfill_progress.json: removed 308 meeting IDs + 10 errors (712 → 404)
- Deleted 457 legacy sections (all from document 666, no extracted_document_id)
- DB now clean: 40,805 sections, all with extracted_document_id, 9,728 have embeddings
- Refactored document viewer into two routes:
  - `/meetings/:id/documents` — new index page listing extracted docs grouped by parent PDF
  - `/meetings/:id/documents/:docId` — single extracted document view (docId = extracted_documents.id, not documents.id)
- Updated meeting-detail links to point to new URL structure
- Deployed to Cloudflare Workers
- Committed extracted docs UI from previous session (8c09ba84)

**Previous sessions:**
- Plans 07.1-01 and 07.1-02 complete (schema + extractor + pipeline integration)
- Plan 07.1-03 Task 1 complete (backfill CLI)
- First backfill: 711 meetings, 12,528 extracted docs, 40,805 sections (after cleanup)
- All data quality cleanup done (dupes, noise, oversized, legacy sections removed)

</completed_work>

<remaining_work>

1. **Wait for Gemini API quota** — daily quota is 0 (not just exhausted). May need billing/plan change on Google AI Studio.
2. **Re-run backfill for 308 meetings**: `cd apps/pipeline && uv run python main.py --extract-documents --concurrency 3`
3. **Generate embeddings** for ~31,077 sections missing them: `uv run python main.py --embed-only`
4. **Complete Plan 03 human-verify checkpoint**
5. **Phase verification**

</remaining_work>

<decisions_made>

- Document viewer split: index route at `/meetings/:id/documents`, detail at `/meetings/:id/documents/:docId` where docId = extracted_documents.id
- The "+N more" overflow link on meeting detail goes to documents index
- Parent PDF title shown as plain text (not a link) on meeting detail since individual extracted docs are the clickable items
- Used `marked` (not react-markdown) for section rendering to avoid Cloudflare Workers SSR hydration mismatches

</decisions_made>

<blockers>
- Gemini API quota: 429 RESOURCE_EXHAUSTED, limit: 0 on generate_requests_per_model_per_day. This is NOT a temporary rate limit — the quota itself is set to 0. Likely needs Google AI Studio billing/plan change.
</blockers>

<context>
DB state:
- extracted_documents: 12,528 (404 meetings covered)
- document_sections: 40,805 (all Gemini, zero legacy)
- embeddings: 9,728 of 40,805 have them
- 308 meetings queued for re-extraction (progress file reset)
- The 308 include all Committee of the Whole meetings (~198) — most substantive content

Key files this session:
- apps/web/app/routes/meeting-documents.tsx — NEW index route
- apps/web/app/routes/document-viewer.tsx — rewritten for single extracted doc
- apps/web/app/routes/meeting-detail.tsx — updated links
- apps/web/app/routes.ts — added new route
- apps/pipeline/backfill_progress.json — reset (308 IDs removed)
</context>

<next_action>
1. Check Gemini API billing at https://ai.google.dev or Google Cloud Console — quota limit of 0 is unusual
2. If quota available: `cd apps/pipeline && uv run python main.py --extract-documents --concurrency 3`
3. Embeddings can run independently (no Gemini needed): `uv run python main.py --embed-only`
4. Commit the document viewer refactor + progress file reset
</next_action>
