---
phase: 17-ocd-interoperability
plan: 05
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/workers/app.ts
autonomous: true
requirements: [OCD-01, OCD-02, OCD-03, OCD-04, OCD-05, OCD-06, OCD-07, OCD-08]
gap_closure: true

must_haves:
  truths:
    - "GET /api/ocd/view-royal/ returns JSON (not HTML 404)"
    - "All OCD endpoints are reachable through the Workers entry point"
  artifacts:
    - path: "apps/web/workers/app.ts"
      provides: "Worker routing that delegates both /api/v1/* and /api/ocd/* to Hono"
      contains: "/api/ocd"
---

<objective>
Fix the Workers entry point to route /api/ocd/* requests to the Hono API app.

Purpose: workers/app.ts only delegates /api/v1/* to Hono â€” /api/ocd/* falls through to React Router which returns HTML 404. The OCD routes are properly mounted in the Hono app but unreachable because the Worker never delegates those requests.

Output: All OCD endpoints reachable and returning JSON responses.
</objective>

<execution_context>
@/Users/kyle/.claude/get-shit-done/workflows/execute-plan.md
@/Users/kyle/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@apps/web/workers/app.ts
@.planning/phases/17-ocd-interoperability/17-UAT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add /api/ocd routing to Workers entry point</name>
  <files>apps/web/workers/app.ts</files>
  <action>
  In `apps/web/workers/app.ts`, update the routing condition on line 29 to also match `/api/ocd/` paths.

  Change:
  ```javascript
  if (url.pathname.startsWith("/api/v1/") || url.pathname === "/api/v1") {
  ```

  To:
  ```javascript
  if (url.pathname.startsWith("/api/v1/") || url.pathname === "/api/v1" || url.pathname.startsWith("/api/ocd/") || url.pathname === "/api/ocd") {
  ```

  This ensures the Worker delegates OCD requests to the Hono app where the OCD router is mounted.
  </action>
  <verify>
  Run the dev server and test: `curl -s http://localhost:5173/api/ocd/view-royal/ | head -5` should return JSON, not HTML.
  Also run `cd /Users/kyle/development/viewroyal/apps/web && npx tsc --noEmit 2>&1 | head -20` to confirm no type errors.
  </verify>
  <done>
  Workers entry point routes /api/ocd/* requests to the Hono API app. All OCD endpoints are reachable.
  </done>
</task>

</tasks>

<verification>
1. curl /api/ocd/view-royal/ returns JSON discovery response
2. No TypeScript compilation errors
3. Existing /api/v1/* routing is unchanged
</verification>

<success_criteria>
- OCD discovery endpoint returns JSON with entity URLs
- All 6 OCD entity endpoints are reachable (not 404)
</success_criteria>

<output>
After completion, create `.planning/phases/17-ocd-interoperability/17-05-SUMMARY.md`
</output>
