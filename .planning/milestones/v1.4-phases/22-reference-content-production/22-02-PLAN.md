---
phase: 22-reference-content-production
plan: 02
type: execute
wave: 2
depends_on:
  - "22-01"
files_modified:
  - apps/docs/content/docs/reference/changelog.mdx
  - apps/docs/content/docs/reference/contributing.mdx
  - apps/docs/app/layout.tsx
  - apps/docs/wrangler.toml
autonomous: false
requirements:
  - REFC-03
  - REFC-04
  - FWRK-03
  - FWRK-04

must_haves:
  truths:
    - "Changelog page follows Keep a Changelog format with v1.0 initial entry grouped by capability"
    - "Changelog page shows a prominent version badge at top"
    - "Contribution guide links to GitHub for bug reports and feature requests"
    - "Search dialog returns results across all documentation pages"
    - "docs.viewroyal.ai serves the static documentation site"
    - "Navigation sidebar correctly groups all sections with all pages visible"
  artifacts:
    - path: "apps/docs/content/docs/reference/changelog.mdx"
      provides: "Changelog with v1.0 entry in Keep a Changelog format"
      contains: "1.0.0"
    - path: "apps/docs/content/docs/reference/contributing.mdx"
      provides: "Contribution guide with GitHub links"
      contains: "github.com"
    - path: "apps/docs/wrangler.toml"
      provides: "Cloudflare Workers Static Assets deployment config"
      contains: "[assets]"
    - path: "apps/docs/app/layout.tsx"
      provides: "RootProvider with static search configuration"
      contains: "static"
  key_links:
    - from: "apps/docs/app/layout.tsx"
      to: "apps/docs/app/api/search/route.ts"
      via: "RootProvider search option type:'static' consuming staticGET index"
      pattern: "type.*static"
    - from: "apps/docs/wrangler.toml"
      to: "apps/docs/out/"
      via: "assets directory pointing to static export output"
      pattern: "directory.*out"
---

<objective>
Author Changelog and Contribution guide pages, configure Orama search for static mode, and deploy the complete documentation site to docs.viewroyal.ai via Cloudflare Workers Static Assets.

Purpose: Complete all reference content and ship the documentation portal to production, making it accessible to developers at docs.viewroyal.ai with working search.
Output: Two MDX content pages, search configuration fix, wrangler.toml for deployment, and a deployed site.
</objective>

<execution_context>
@/Users/kyle/.claude/get-shit-done/workflows/execute-plan.md
@/Users/kyle/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/22-reference-content-production/22-CONTEXT.md
@.planning/phases/22-reference-content-production/22-RESEARCH.md
@.planning/phases/22-reference-content-production/22-01-SUMMARY.md
@apps/docs/app/layout.tsx
@apps/docs/app/api/search/route.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Author Changelog and Contributing pages, fix search, and create deployment config</name>
  <files>
    apps/docs/content/docs/reference/changelog.mdx
    apps/docs/content/docs/reference/contributing.mdx
    apps/docs/app/layout.tsx
    apps/docs/wrangler.toml
  </files>
  <action>
1. Create `apps/docs/content/docs/reference/changelog.mdx`:

   Frontmatter: title "Changelog", description "Notable changes to the ViewRoyal.ai API"

   Follow Keep a Changelog format (keepachangelog.com) per user decision:

   - Start with a prominent version badge using Callout:
     ```
     import { Callout } from 'fumadocs-ui/components/callout';

     <Callout type="info">
       **Current Version: v1.0**
     </Callout>
     ```

   - Brief intro paragraph explaining this page tracks notable changes to the API, following Keep a Changelog format. Link to keepachangelog.com.

   - `## [1.0.0] - 2026-02-22` (v1.3 shipped date -- when the full API was complete)

   - Group by capability (per user decision -- NOT individual endpoints):

     ### Added
     - **Meetings API**: List and retrieve council meetings with agenda items, motions, attendance, and document sections
     - **People API**: Council members and staff with voting records, speaking time, and membership history
     - **Matters API**: Legislative matters tracked across meetings with lifecycle status and linked agenda items
     - **Motions API**: Formal decisions with mover/seconder, vote tallies, and individual roll call votes
     - **Bylaws API**: Municipal legislation with full text, AI summaries, and linked matters
     - **Search API**: Cross-content keyword search across motions, matters, and documents
     - **OCD Interoperability**: Open Civic Data standard endpoints for jurisdictions, organizations, people, events, bills, and votes
     - **Authentication**: API key management via X-API-Key header with per-key rate limiting
     - **Pagination**: Cursor-based pagination (v1 API) and page-based pagination (OCD API)
     - **Developer Portal**: API reference documentation, getting started guide, authentication, pagination, and error handling guides

2. Create `apps/docs/content/docs/reference/contributing.mdx`:

   Frontmatter: title "Contributing", description "How to contribute to ViewRoyal.ai"

   Keep it lightweight (under 100 lines per discretion recommendation). Content:

   - **Overview**: Brief paragraph -- ViewRoyal.ai is an open civic intelligence platform. Contributions welcome via GitHub.

   - **Reporting Bugs**: Use GitHub Issues. Link to the repo issues page (https://github.com/k-yle/viewroyal/issues -- verify correct URL from git remote). Describe what to include in a bug report: endpoint URL, request parameters, expected vs actual response, API key prefix (never the full key).

   - **Requesting Features**: Same GitHub Issues link. Describe what to include: use case, which API endpoints/entities, any standards or formats to consider.

   - **API Feedback**: Encourage feedback on response shapes, missing fields, or documentation clarity. Same GitHub Issues link.

   - **Important Notes**:
     - The API is read-only -- there are no write endpoints
     - Data comes from public council meeting records
     - The OCD endpoints follow the Open Civic Data specification

   Check the actual GitHub remote URL:
   ```bash
   cd /Users/kyle/development/viewroyal && git remote get-url origin
   ```
   Use the actual URL (likely github.com/kyleawayan/viewroyal or similar).

3. Fix search configuration in `apps/docs/app/layout.tsx`:

   Update the RootProvider to use static search mode. The search route already uses `staticGET` which generates a JSON index at build time, but the client needs to know to use it:

   ```tsx
   <RootProvider search={{ options: { type: 'static' } }}>
     {children}
   </RootProvider>
   ```

   Without this, the search dialog may try to fetch from the API route at runtime, which doesn't work in a static export.

4. Create `apps/docs/wrangler.toml` for Cloudflare Workers Static Assets deployment:

   ```toml
   name = "viewroyal-docs"
   compatibility_date = "2025-04-01"

   [assets]
   directory = "./out"
   not_found_handling = "404-page"
   ```

   Key decisions:
   - No `main` entry point -- purely static, no Worker script needed
   - `directory = "./out"` points to Next.js static export output
   - `not_found_handling = "404-page"` serves the nearest 404.html
   - Custom domain (docs.viewroyal.ai) will be configured via Cloudflare dashboard after initial deploy (DNS must be managed by Cloudflare -- the CNAME/A record is created automatically when adding a Custom Domain in the dashboard)
   - NOT using Cloudflare Pages (deprecated April 2025) -- using Workers Static Assets per project decision in STATE.md

5. Build and verify locally:
   ```bash
   cd /Users/kyle/development/viewroyal/apps/docs && pnpm build
   ```
   Verify all pages are generated, including all 4 reference pages, all 4 guide pages, and all API reference pages.

6. Deploy to Cloudflare:
   ```bash
   cd /Users/kyle/development/viewroyal/apps/docs && npx wrangler deploy
   ```
   This creates the Worker with static assets. The site will be accessible at the Workers default domain initially (e.g., viewroyal-docs.{account}.workers.dev).
  </action>
  <verify>
    <automated>cd /Users/kyle/development/viewroyal/apps/docs && pnpm build 2>&1 | tail -30</automated>
    <manual>Visit the deployed Workers URL to verify all pages load, sidebar shows all sections, and search returns results</manual>
  </verify>
  <done>Changelog with v1.0 entry in Keep a Changelog format. Contributing guide with GitHub links. Search configured for static mode. wrangler.toml configured for Workers Static Assets. Build succeeds with all pages.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify deployed documentation site</name>
  <files>n/a -- verification only</files>
  <action>
Human verifies the deployed documentation portal:

**What was built:** Complete documentation portal deployed to Cloudflare Workers with all reference content (Data Model, OCD Standard, Changelog, Contributing), all guides, API reference, working search, and sidebar navigation.

**Verification steps:**
1. Visit the deployed Workers URL (shown in deploy output, e.g., https://viewroyal-docs.{account}.workers.dev)
2. Verify sidebar shows: Getting Started > Guides (Authentication, Pagination, Error Handling) > API Reference (grouped by resource) > Reference (Data Model, OCD Standard, Changelog, Contributing)
3. Navigate to Reference > Data Model -- verify Mermaid ER diagram renders with entity relationships
4. Toggle dark mode -- verify Mermaid diagram re-renders with dark theme
5. Navigate to Reference > OCD Standard -- verify comparison table and entity mapping table with real OCD IDs
6. Navigate to Reference > Changelog -- verify v1.0 entry with version badge
7. Navigate to Reference > Contributing -- verify GitHub links
8. Open search (Cmd+K) and search for "meetings" -- verify results appear from multiple sections
9. If everything looks good, configure custom domain: Cloudflare dashboard > Workers & Pages > viewroyal-docs > Settings > Domains & Routes > Add Custom Domain > enter "docs.viewroyal.ai"

**Resume signal:** Type "approved" if the site looks correct, or describe any issues to fix.
  </action>
  <verify>Human confirms all verification steps pass</verify>
  <done>Deployed documentation site passes all verification checks and custom domain is configured</done>
</task>

</tasks>

<verification>
1. `pnpm build` completes with zero errors
2. Built output includes all 4 reference pages (data-model, ocd-standard, changelog, contributing)
3. Search route generates static index at build time
4. RootProvider configured with `type: 'static'` search
5. wrangler.toml has `[assets] directory = "./out"`
6. `wrangler deploy` succeeds
7. Deployed site serves all pages correctly
8. Search returns results across all documentation sections
</verification>

<success_criteria>
- All four reference content pages exist and render correctly
- Changelog follows Keep a Changelog format with v1.0 entry
- Contributing guide has GitHub issue links
- Search dialog returns results when querying
- Site is deployed and accessible via Cloudflare Workers
- Custom domain docs.viewroyal.ai is configured (via dashboard after deploy)
</success_criteria>

<output>
After completion, create `.planning/phases/22-reference-content-production/22-02-SUMMARY.md`
</output>
