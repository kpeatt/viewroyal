---
phase: 21-developer-guides
plan: 02
type: execute
wave: 2
depends_on: [21-01]
files_modified:
  - apps/docs/content/docs/guides/pagination.mdx
  - apps/docs/content/docs/guides/error-handling.mdx
autonomous: true
requirements: [GUID-03, GUID-04]

must_haves:
  truths:
    - "Pagination guide explains cursor-based (v1) and page-based (OCD) pagination with working code examples"
    - "Error Handling guide documents every error code with response shapes and retry logic examples"
    - "Static build completes with all 4 guides visible in sidebar navigation"
  artifacts:
    - path: "apps/docs/content/docs/guides/pagination.mdx"
      provides: "Cursor-based and page-based pagination documentation"
      min_lines: 80
    - path: "apps/docs/content/docs/guides/error-handling.mdx"
      provides: "Complete error code reference with retry logic"
      min_lines: 80
  key_links:
    - from: "apps/docs/content/docs/guides/pagination.mdx"
      to: "/docs/api-reference"
      via: "cross-links to list endpoint references"
      pattern: "/docs/api-reference/"
    - from: "apps/docs/content/docs/guides/error-handling.mdx"
      to: "/docs/guides/authentication"
      via: "cross-link to auth guide for rate limit details"
      pattern: "/docs/guides/authentication"
---

<objective>
Create the Pagination and Error Handling guides as MDX content, completing all four developer guides for the documentation portal.

Purpose: A developer integrating with the API needs to understand two distinct pagination patterns (cursor-based for v1 endpoints, page-based for OCD endpoints) and know how to handle every possible error response. These guides complete the GUID requirement set.

Output: 2 files -- pagination.mdx and error-handling.mdx. After this plan, all 4 guides referenced in guides/meta.json exist and the full static build includes the complete Guides section.
</objective>

<execution_context>
@/Users/kyle/.claude/get-shit-done/workflows/execute-plan.md
@/Users/kyle/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/21-developer-guides/21-RESEARCH.md
@.planning/phases/21-developer-guides/21-01-SUMMARY.md

# Key source files for accurate pagination and error details
@apps/web/app/api/lib/cursor.ts
@apps/web/app/api/lib/envelope.ts
@apps/web/app/api/ocd/lib/pagination.ts
@apps/web/app/api/ocd/lib/ocd-envelope.ts
@apps/web/app/api/middleware/error-handler.ts
@apps/web/app/api/lib/api-errors.ts
@apps/web/app/api/endpoints/search.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Pagination guide</name>
  <files>
    apps/docs/content/docs/guides/pagination.mdx
  </files>
  <action>
Create `apps/docs/content/docs/guides/pagination.mdx` with frontmatter title "Pagination" and description "Navigate through large result sets with cursor-based and page-based pagination".

Use `import { Tab, Tabs } from 'fumadocs-ui/components/tabs';` and `import { Callout } from 'fumadocs-ui/components/callout';` at the top.

Content structure (all details verified in RESEARCH.md from source code):

- **Overview paragraph**: The API uses two pagination systems. v1 API endpoints (meetings, people, matters, motions, bylaws) use cursor-based pagination. OCD API endpoints use page-based pagination. The search endpoint is a hybrid (page-based params but v1-style envelope).

- **Cursor-Based Pagination (v1 API) section**:
  - Parameters: `per_page` (default 20, max 100) and `cursor` (opaque string, omit for first page).
  - Response shape (from RESEARCH.md):
    ```json
    {
      "data": [...],
      "pagination": {
        "has_more": true,
        "next_cursor": "eyJ2IjoiMjAyNC0wMS0xNSIsImlkIjo0Mn0=",
        "per_page": 20
      },
      "meta": { "request_id": "..." }
    }
    ```
  - **How to paginate**: Check `pagination.has_more`. If `true`, pass `pagination.next_cursor` as the `cursor` query parameter in the next request. If `false`, you've reached the end.
  - **Complete example**: Show curl/JS/Python Tabs with `groupId="language"` demonstrating fetching page 1, checking has_more, then fetching page 2 using next_cursor. Use `GET /api/v1/view-royal/meetings?per_page=5` as the example endpoint.
  - Use `<Callout type="info">` to note: "Cursors are opaque tokens. Never attempt to decode, construct, or modify them. Always use the exact `next_cursor` value from the previous response."
  - **Full iteration example** in JavaScript and Python showing a loop that fetches all pages:
    ```javascript
    let cursor = null;
    let allMeetings = [];
    do {
      const url = new URL('https://viewroyal.ai/api/v1/view-royal/meetings');
      url.searchParams.set('per_page', '20');
      if (cursor) url.searchParams.set('cursor', cursor);
      const res = await fetch(url, { headers: { 'X-API-Key': API_KEY } });
      const json = await res.json();
      allMeetings.push(...json.data);
      cursor = json.pagination.next_cursor;
    } while (cursor);
    ```
    Show equivalent Python with `requests` library.

- **Page-Based Pagination (OCD API) section**:
  - Parameters: `page` (default 1) and `per_page` (default 20, max 100).
  - Response shape (from RESEARCH.md):
    ```json
    {
      "results": [...],
      "pagination": {
        "page": 1,
        "per_page": 20,
        "max_page": 5,
        "total_items": 93
      }
    }
    ```
  - **How to paginate**: Increment `page` until `page >= max_page`. Use `total_items` to show progress.
  - **Example**: Show curl/JS/Python Tabs for `GET /api/ocd/view-royal/people?page=1&per_page=10`.
  - Note: OCD detail responses are not paginated -- they return the full entity at the top level.

- **Search Endpoint (Hybrid) section**: Brief note that `GET /api/v1/view-royal/search?q=budget&page=1&per_page=10` uses page-based parameters (`page`, `per_page`) but returns the v1 response envelope (`data`, `pagination`, `meta`). The pagination object includes `has_more`, `per_page`, and `page` but `next_cursor` is always `null`. Link to the [Search endpoint reference](/docs/api-reference/search) for full details.

- **Quick Reference table**:
  | Feature | v1 Endpoints | OCD Endpoints | Search |
  |---------|-------------|---------------|--------|
  | Style | Cursor-based | Page-based | Page-based |
  | Parameters | `cursor`, `per_page` | `page`, `per_page` | `page`, `per_page` |
  | Default per_page | 20 | 20 | 20 |
  | Max per_page | 100 | 100 | 100 |
  | Envelope | `data` + `pagination` + `meta` | `results` + `pagination` | `data` + `pagination` + `meta` |
  | Next page signal | `has_more` + `next_cursor` | `page < max_page` | `has_more` |
  </action>
  <verify>
    <automated>cd /Users/kyle/development/viewroyal && pnpm --filter docs build 2>&1 | tail -20</automated>
    <manual>Confirm pagination.mdx renders correctly in build output</manual>
  </verify>
  <done>pagination.mdx exists with cursor-based and page-based pagination documentation, working code examples in curl/JS/Python, full iteration examples, search hybrid explanation, and quick reference table. Build succeeds.</done>
</task>

<task type="auto">
  <name>Task 2: Create Error Handling guide and verify complete build</name>
  <files>
    apps/docs/content/docs/guides/error-handling.mdx
  </files>
  <action>
Create `apps/docs/content/docs/guides/error-handling.mdx` with frontmatter title "Error Handling" and description "Error codes, response shapes, and retry strategies for the ViewRoyal.ai API".

Use `import { Tab, Tabs } from 'fumadocs-ui/components/tabs';` and `import { Callout } from 'fumadocs-ui/components/callout';` at the top.

Content structure (all error codes from RESEARCH.md, verified against source):

- **Error Response Shape section**: All API errors follow a consistent envelope:
  ```json
  {
    "error": {
      "code": "ERROR_CODE",
      "message": "Human-readable description of what went wrong",
      "status": 400
    }
  }
  ```
  The `code` field is a SCREAMING_SNAKE_CASE machine-readable identifier. The `message` field is a human-readable description. The `status` field matches the HTTP status code.

- **Error Codes Reference section**: Complete table of all error codes from the API (from RESEARCH.md error inventory):

  **Client Errors (4xx)**:

  | HTTP Status | Code | Description |
  |-------------|------|-------------|
  | 400 | `VALIDATION_ERROR` | Request validation failed (invalid query parameters or missing required fields) |
  | 400 | `INVALID_TYPE` | Invalid search type filter value |
  | 401 | `MISSING_API_KEY` | No API key provided in request |
  | 401 | `INVALID_API_KEY` | API key not found or has been revoked |
  | 404 | `NOT_FOUND` | Requested endpoint does not exist |
  | 404 | `MUNICIPALITY_NOT_FOUND` | Invalid municipality slug in URL |
  | 404 | `MEETING_NOT_FOUND` | Meeting with given slug not found |
  | 404 | `PERSON_NOT_FOUND` | Person with given slug not found |
  | 404 | `MATTER_NOT_FOUND` | Matter with given slug not found |
  | 404 | `MOTION_NOT_FOUND` | Motion with given slug not found |
  | 404 | `BYLAW_NOT_FOUND` | Bylaw with given slug not found |
  | 404 | `EVENT_NOT_FOUND` | OCD event not found |
  | 404 | `BILL_NOT_FOUND` | OCD bill not found |
  | 404 | `VOTE_NOT_FOUND` | OCD vote not found |
  | 404 | `ORGANIZATION_NOT_FOUND` | OCD organization not found |
  | 404 | `JURISDICTION_NOT_FOUND` | OCD jurisdiction not found |
  | 429 | `RATE_LIMIT_EXCEEDED` | Rate limit of 100 requests per 60 seconds exceeded |

  **Server Errors (5xx)**:

  | HTTP Status | Code | Description |
  |-------------|------|-------------|
  | 500 | `INTERNAL_ERROR` | Unexpected server error |
  | 500 | `QUERY_ERROR` | Database query failure |

- **Handling Errors by Status Code section**: Group by HTTP status with guidance:
  - **400 Bad Request**: Check your query parameters. Show example of a VALIDATION_ERROR response and how to fix (e.g., `per_page=999` exceeds max of 100).
  - **401 Unauthorized**: Check your API key. Show both MISSING_API_KEY and INVALID_API_KEY examples. Link to [Authentication guide](/docs/guides/authentication) for details.
  - **404 Not Found**: Resource doesn't exist. Use `<Callout type="info">` to note that `NOT_FOUND` means the endpoint path is wrong, while entity-specific codes like `MEETING_NOT_FOUND` mean the slug/ID is invalid.
  - **429 Rate Limited**: You've exceeded 100 req/60s. Check the `Retry-After` header. Link to [Authentication guide](/docs/guides/authentication#rate-limiting) for rate limit details.
  - **500 Server Error**: Not your fault. Retry with backoff. If persistent, report at GitHub issues.

- **Retry Logic section**: Show practical retry code in JS and Python using Tabs with `groupId="language"`. The example should:
  1. Make a request
  2. If 429: read `Retry-After` header, wait that many seconds, retry
  3. If 500: retry up to 3 times with exponential backoff (1s, 2s, 4s)
  4. If 400/401/404: do NOT retry (client error, retrying won't help)

  JavaScript example using `fetch` with async/await. Python example using `requests` with `time.sleep`. Both examples should be complete, copy-pasteable functions.

- **Response Headers section**: Brief reference:
  | Header | Present | Description |
  |--------|---------|-------------|
  | `X-Request-Id` | Every response | Unique request identifier for debugging |
  | `X-RateLimit-Limit` | Authenticated endpoints | Your rate limit (always 100) |
  | `Retry-After` | 429 responses only | Seconds to wait before retrying |

  Use `<Callout type="info">` to suggest: "Include the X-Request-Id value when reporting issues. It helps us locate your specific request in our logs."

After creating the file, run the full build to verify all 4 guides render correctly and the sidebar shows the complete Guides section.
  </action>
  <verify>
    <automated>cd /Users/kyle/development/viewroyal && pnpm --filter docs build 2>&1 | tail -20</automated>
    <manual>Verify build output contains HTML for all 4 guide pages: getting-started, authentication, pagination, error-handling</manual>
  </verify>
  <done>error-handling.mdx exists with complete error code inventory (19 codes), handling guidance by status, retry logic examples in JS/Python, response headers reference. Full build completes with zero errors and all 4 guides visible in sidebar.</done>
</task>

</tasks>

<verification>
1. `pnpm --filter docs build` completes with zero errors
2. Build output contains HTML pages for all 4 guides (getting-started, authentication, pagination, error-handling)
3. Sidebar shows complete Guides section with all 4 entries in correct order
4. Pagination guide covers both cursor-based (v1) and page-based (OCD) patterns with working examples
5. Error handling guide lists all 19 error codes from the API source code
6. All code examples use correct API URLs and response shapes matching RESEARCH.md
</verification>

<success_criteria>
- Pagination guide explains both pagination systems with complete iteration examples
- Error handling guide documents every error code found in the codebase
- Retry logic examples are copy-pasteable and handle 429/500 correctly
- All 4 guides use consistent fumadocs components (Tabs with groupId="language", Callout)
- Complete static build succeeds with all guide pages rendered
</success_criteria>

<output>
After completion, create `.planning/phases/21-developer-guides/21-02-SUMMARY.md`
</output>
