---
phase: 19-infrastructure-scaffolding
plan: 02
type: execute
wave: 2
depends_on:
  - 19-01
files_modified:
  - apps/docs/package.json
  - apps/docs/next.config.mjs
  - apps/docs/source.config.ts
  - apps/docs/tsconfig.json
  - apps/docs/app/layout.tsx
  - apps/docs/app/docs/layout.tsx
  - apps/docs/app/docs/[[...slug]]/page.tsx
  - apps/docs/app/api/search/route.ts
  - apps/docs/lib/source.ts
  - apps/docs/mdx-components.tsx
  - apps/docs/tailwind.css
  - apps/docs/content/docs/index.mdx
  - apps/docs/content/docs/meta.json
autonomous: true
requirements:
  - FWRK-01
  - FWRK-02

must_haves:
  truths:
    - "apps/docs/ contains a fumadocs v16 + Next.js 16 site with all required source files"
    - "pnpm install from root resolves apps/docs dependencies alongside existing workspace members"
    - "next build in apps/docs produces a static out/ directory with HTML files"
    - "The static build completes with zero errors"
    - "Opening out/docs/index.html shows a page with sidebar navigation and dark mode toggle"
  artifacts:
    - path: "apps/docs/package.json"
      provides: "App dependencies including fumadocs-ui, fumadocs-core, fumadocs-mdx, next, react"
      contains: "fumadocs-ui"
    - path: "apps/docs/next.config.mjs"
      provides: "Static export configuration with fumadocs MDX plugin"
      contains: "output: 'export'"
    - path: "apps/docs/source.config.ts"
      provides: "fumadocs-mdx collection definitions"
      contains: "defineDocs"
    - path: "apps/docs/lib/source.ts"
      provides: "Content source loader"
      contains: "loader"
    - path: "apps/docs/app/layout.tsx"
      provides: "Root layout with RootProvider for dark mode"
      contains: "RootProvider"
    - path: "apps/docs/app/docs/layout.tsx"
      provides: "Docs layout with sidebar navigation"
      contains: "DocsLayout"
    - path: "apps/docs/app/docs/[[...slug]]/page.tsx"
      provides: "Dynamic page renderer with generateStaticParams"
      contains: "generateStaticParams"
    - path: "apps/docs/app/api/search/route.ts"
      provides: "Static search index endpoint for Orama"
      contains: "staticGET"
    - path: "apps/docs/content/docs/index.mdx"
      provides: "Placeholder landing page content"
      contains: "ViewRoyal.ai"
  key_links:
    - from: "apps/docs/lib/source.ts"
      to: "apps/docs/source.config.ts"
      via: "fumadocs-mdx:collections/server import"
      pattern: "fumadocs-mdx:collections"
    - from: "apps/docs/app/docs/layout.tsx"
      to: "apps/docs/lib/source.ts"
      via: "source.pageTree for sidebar"
      pattern: "source\\.pageTree"
    - from: "apps/docs/app/docs/[[...slug]]/page.tsx"
      to: "apps/docs/lib/source.ts"
      via: "source.getPage for page rendering"
      pattern: "source\\.getPage"
    - from: "apps/docs/app/api/search/route.ts"
      to: "apps/docs/lib/source.ts"
      via: "createFromSource for search index"
      pattern: "createFromSource"
    - from: "apps/docs/next.config.mjs"
      to: "fumadocs-mdx/next"
      via: "createMDX plugin wrapper"
      pattern: "createMDX"
---

<objective>
Scaffold a fumadocs v16 + Next.js 16 documentation site in apps/docs with static export, and verify the build produces a complete static site with navigation, search, and dark mode.

Purpose: Establish the documentation site foundation that all content phases (20-22) will build on. A working static build pipeline is required before any API reference, guides, or reference content can be authored.

Output: Complete fumadocs scaffold in apps/docs/, verified static build producing out/ directory, all fumadocs features (sidebar, search, dark mode) functional.
</objective>

<execution_context>
@/Users/kyle/.claude/get-shit-done/workflows/execute-plan.md
@/Users/kyle/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-infrastructure-scaffolding/19-RESEARCH.md
@.planning/phases/19-infrastructure-scaffolding/19-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create fumadocs scaffold with all source files</name>
  <files>
    apps/docs/package.json
    apps/docs/next.config.mjs
    apps/docs/source.config.ts
    apps/docs/tsconfig.json
    apps/docs/app/layout.tsx
    apps/docs/app/docs/layout.tsx
    apps/docs/app/docs/[[...slug]]/page.tsx
    apps/docs/app/api/search/route.ts
    apps/docs/lib/source.ts
    apps/docs/mdx-components.tsx
    apps/docs/tailwind.css
    apps/docs/content/docs/index.mdx
    apps/docs/content/docs/meta.json
  </files>
  <action>
Create the fumadocs scaffold manually (not via create-fumadocs-app) for full control. Reference all code patterns from 19-RESEARCH.md exactly.

**1. apps/docs/package.json:**
```json
{
  "name": "docs",
  "private": true,
  "type": "module",
  "scripts": {
    "dev": "next dev --turbopack",
    "build": "next build",
    "start": "next start"
  },
  "dependencies": {
    "fumadocs-ui": "^16.6.5",
    "fumadocs-core": "^16.6.5",
    "fumadocs-mdx": "^14.2.8",
    "next": "^16.0.0",
    "react": "^19.2.0",
    "react-dom": "^19.2.0",
    "@types/mdx": "^2.0.13"
  },
  "devDependencies": {
    "tailwindcss": "^4.0.0",
    "@types/react": "^19.2.0",
    "@types/react-dom": "^19.2.0",
    "typescript": "^5.9.0"
  }
}
```

**2. apps/docs/next.config.mjs** — Static export + fumadocs MDX plugin:
```javascript
import { createMDX } from 'fumadocs-mdx/next';

const withMDX = createMDX();

/** @type {import('next').NextConfig} */
const nextConfig = {
  output: 'export',
  images: {
    unoptimized: true,
  },
};

export default withMDX(nextConfig);
```

**3. apps/docs/source.config.ts** — Collection definitions:
```typescript
import { defineDocs, defineConfig } from 'fumadocs-mdx/config';

export const docs = defineDocs({
  dir: 'content/docs',
});

export default defineConfig();
```

**4. apps/docs/tsconfig.json** — TypeScript config with fumadocs paths:
```json
{
  "compilerOptions": {
    "target": "ESNext",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "ESNext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [{ "name": "next" }],
    "paths": {
      "@/*": ["./*"],
      "fumadocs-mdx:collections/*": [".source/*"]
    }
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", "**/*.mdx", ".source/**/*.ts"],
  "exclude": ["node_modules", "out"]
}
```
CRITICAL: The `"fumadocs-mdx:collections/*": [".source/*"]` path is required for TypeScript to resolve the virtual module import in lib/source.ts.
CRITICAL: Include `.source/**/*.ts` in the `include` array so generated types are picked up.

**5. apps/docs/app/layout.tsx** — Root layout with RootProvider (fumadocs v16 import path):
```typescript
import { RootProvider } from 'fumadocs-ui/provider/next';
import type { ReactNode } from 'react';
import './tailwind.css';

export default function RootLayout({ children }: { children: ReactNode }) {
  return (
    <html lang="en" suppressHydrationWarning>
      <body>
        <RootProvider>{children}</RootProvider>
      </body>
    </html>
  );
}
```
IMPORTANT: Import from `fumadocs-ui/provider/next` (NOT `fumadocs-ui/provider` which was removed in v16).

**6. apps/docs/app/docs/layout.tsx** — Docs layout with sidebar:
```typescript
import { DocsLayout } from 'fumadocs-ui/layouts/docs';
import type { ReactNode } from 'react';
import { source } from '@/lib/source';

export default function Layout({ children }: { children: ReactNode }) {
  return (
    <DocsLayout
      tree={source.pageTree}
      nav={{ title: 'ViewRoyal.ai API Docs' }}
    >
      {children}
    </DocsLayout>
  );
}
```

**7. apps/docs/app/docs/[[...slug]]/page.tsx** — Dynamic page renderer:
```typescript
import { source } from '@/lib/source';
import { notFound } from 'next/navigation';
import {
  DocsPage,
  DocsBody,
  DocsTitle,
  DocsDescription,
} from 'fumadocs-ui/page';
import defaultMdxComponents from 'fumadocs-ui/mdx';

export default async function Page(props: {
  params: Promise<{ slug?: string[] }>;
}) {
  const params = await props.params;
  const page = source.getPage(params.slug);
  if (!page) notFound();

  const MDX = page.data.body;

  return (
    <DocsPage toc={page.data.toc} full={page.data.full}>
      <DocsTitle>{page.data.title}</DocsTitle>
      <DocsDescription>{page.data.description}</DocsDescription>
      <DocsBody>
        <MDX components={{ ...defaultMdxComponents }} />
      </DocsBody>
    </DocsPage>
  );
}

export function generateStaticParams() {
  return source.generateParams();
}
```
IMPORTANT: Next.js 16 requires `params` to be a Promise — use `await props.params`.

**8. apps/docs/app/api/search/route.ts** — Static search index:
```typescript
import { source } from '@/lib/source';
import { createFromSource } from 'fumadocs-core/search/server';

export const revalidate = false;
export const { staticGET: GET } = createFromSource(source);
```

**9. apps/docs/lib/source.ts** — Content source configuration:
```typescript
import { docs } from 'fumadocs-mdx:collections/server';
import { loader } from 'fumadocs-core/source';

export const source = loader({
  baseUrl: '/docs',
  source: docs.toFumadocsSource(),
});
```

**10. apps/docs/mdx-components.tsx** — MDX component overrides:
```typescript
import defaultComponents from 'fumadocs-ui/mdx';
import type { MDXComponents } from 'mdx/types';

export function useMDXComponents(components: MDXComponents): MDXComponents {
  return {
    ...defaultComponents,
    ...components,
  };
}
```

**11. apps/docs/tailwind.css** — Tailwind v4 CSS-first config:
```css
@import 'tailwindcss';
@import 'fumadocs-ui/css/neutral.css';
@import 'fumadocs-ui/css/preset.css';
@source '../node_modules/fumadocs-ui/dist/**/*.js';
```
No tailwind.config.js — fumadocs v15+ uses Tailwind v4 CSS imports.

**12. apps/docs/content/docs/index.mdx** — Placeholder landing page:
```mdx
---
title: ViewRoyal.ai API Documentation
description: Developer documentation for the ViewRoyal.ai civic intelligence API
---

## Welcome

ViewRoyal.ai provides a RESTful API for accessing council meeting data,
agenda items, motions, and more for the Town of View Royal, BC.

## Getting Started

Documentation is being built. Check back soon for:

- **API Reference** — Auto-generated endpoint documentation
- **Guides** — Authentication, pagination, error handling
- **Data Model** — Entity relationships and schemas
```

**13. apps/docs/content/docs/meta.json** — Sidebar navigation ordering:
```json
{
  "root": true,
  "pages": ["---Getting Started---", "..."]
}
```

After creating all files, run `pnpm install` from the monorepo root to install the new apps/docs dependencies into the workspace.
  </action>
  <verify>
    <automated>cd /Users/kyle/development/viewroyal && test -f apps/docs/package.json && test -f apps/docs/next.config.mjs && test -f apps/docs/source.config.ts && test -f apps/docs/lib/source.ts && test -f apps/docs/app/layout.tsx && test -f apps/docs/app/docs/layout.tsx && test -f "apps/docs/app/docs/[[...slug]]/page.tsx" && test -f apps/docs/content/docs/index.mdx && pnpm install --dir /Users/kyle/development/viewroyal 2>&1 | tail -3 && echo "PASS: scaffold complete, dependencies installed"</automated>
  </verify>
  <done>All 13 fumadocs source files exist in apps/docs/. pnpm install from root resolves all workspace dependencies including the new apps/docs member.</done>
</task>

<task type="auto">
  <name>Task 2: Build static site and verify output</name>
  <files></files>
  <action>
Run the static export build and verify the output:

1. **Build**: Run `pnpm --filter docs build` from the monorepo root (or `pnpm run build` from `apps/docs/`). This runs `next build` which with `output: 'export'` produces a static `out/` directory.

2. **Verify output directory**: Check that `apps/docs/out/` exists and contains:
   - `index.html` (root page)
   - `docs/index.html` (docs landing page)
   - `api/search/route.json` or similar static search index file
   - CSS/JS bundles in `_next/` directory

3. **Verify existing apps still build**: Run `pnpm --filter web build` to confirm the workspace addition of apps/docs didn't break apps/web. This is a regression check.

4. **Add out/ to .gitignore**: Create or update `apps/docs/.gitignore` to exclude:
   ```
   .next/
   out/
   .source/
   node_modules/
   ```
   The `.source/` directory is generated by fumadocs-mdx at build time and should not be committed.

If the build fails:
- Check for the common pitfalls documented in 19-RESEARCH.md:
  - Missing `images: { unoptimized: true }` (Pitfall 4)
  - Wrong provider import path (Pitfall 5)
  - Dynamic API route incompatible with static export (Pitfall 6) — ensure `staticGET` is used
  - TypeScript path for fumadocs-mdx collections (Pitfall 7) — ensure tsconfig paths are set
- Fix any issues and re-run build until it succeeds with zero errors
  </action>
  <verify>
    <automated>cd /Users/kyle/development/viewroyal && pnpm --filter docs build 2>&1 | tail -10 && test -d apps/docs/out && test -f apps/docs/out/docs/index.html && echo "PASS: static build succeeded, output exists"</automated>
  </verify>
  <done>next build completes with zero errors. apps/docs/out/ directory contains static HTML/CSS/JS. docs/index.html renders the placeholder content. apps/web still builds correctly (no regression). .gitignore excludes build artifacts.</done>
</task>

</tasks>

<verification>
1. `apps/docs/package.json` lists fumadocs-ui, fumadocs-core, fumadocs-mdx, next, react as dependencies
2. `apps/docs/next.config.mjs` has `output: 'export'` and `images: { unoptimized: true }`
3. `pnpm --filter docs build` succeeds with zero errors
4. `apps/docs/out/` directory contains static HTML files
5. `apps/docs/out/docs/index.html` exists (landing page rendered)
6. `pnpm --filter web build` still succeeds (no regression)
7. `.gitignore` excludes `.next/`, `out/`, `.source/`
</verification>

<success_criteria>
- Fumadocs site scaffolded in apps/docs with Next.js 16 and fumadocs v16 (FWRK-01)
- Static export builds successfully with `output: 'export'` producing a static `out/` directory (FWRK-02)
- The static build completes with zero errors
- No regressions in existing apps/web build
</success_criteria>

<output>
After completion, create `.planning/phases/19-infrastructure-scaffolding/19-02-SUMMARY.md`
</output>
