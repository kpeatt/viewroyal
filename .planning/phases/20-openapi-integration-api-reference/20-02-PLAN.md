---
phase: 20-openapi-integration-api-reference
plan: 02
type: execute
wave: 2
depends_on: ["20-01"]
files_modified:
  - apps/docs/components/api-page.tsx
  - apps/docs/components/api-page.client.tsx
  - apps/docs/mdx-components.tsx
  - apps/docs/tailwind.css
  - apps/docs/content/docs/meta.json
  - apps/docs/content/docs/api-reference/meta.json
  - apps/docs/app/docs/[[...slug]]/page.tsx
autonomous: true
requirements: [AREF-02, AREF-03, AREF-04]

must_haves:
  truths:
    - "API reference pages render in the browser with endpoint details, parameters, and response schemas"
    - "Interactive playground is visible on each API reference page and can execute live requests"
    - "Code examples in curl, JavaScript, and Python are visible on each API reference page"
    - "Sidebar navigation shows API Reference section with all tag groups (Meetings, People, etc.)"
    - "Static export build completes with zero errors"
  artifacts:
    - path: "apps/docs/components/api-page.tsx"
      provides: "Server-side APIPage wrapper using createAPIPage"
      min_lines: 5
    - path: "apps/docs/components/api-page.client.tsx"
      provides: "Client-side config for playground and interactivity"
      contains: "use client"
    - path: "apps/docs/mdx-components.tsx"
      provides: "MDX component registration including APIPage"
      contains: "APIPage"
    - path: "apps/docs/tailwind.css"
      provides: "CSS with fumadocs-openapi preset imported"
      contains: "fumadocs-openapi/css/preset.css"
    - path: "apps/docs/content/docs/meta.json"
      provides: "Root sidebar with API Reference section"
      contains: "api-reference"
    - path: "apps/docs/content/docs/api-reference/meta.json"
      provides: "Tag group ordering in sidebar"
  key_links:
    - from: "apps/docs/components/api-page.tsx"
      to: "apps/docs/lib/openapi.ts"
      via: "import openapi"
      pattern: "import.*openapi.*from.*lib/openapi"
    - from: "apps/docs/components/api-page.tsx"
      to: "apps/docs/components/api-page.client.tsx"
      via: "import client config"
      pattern: "import.*client.*from.*api-page\\.client"
    - from: "apps/docs/mdx-components.tsx"
      to: "apps/docs/components/api-page.tsx"
      via: "APIPage component registration"
      pattern: "APIPage"
    - from: "generated MDX files"
      to: "apps/docs/mdx-components.tsx"
      via: "MDX component resolution"
      pattern: "<APIPage"
---

<objective>
Create the API page rendering components, register them in MDX, add OpenAPI CSS styles, configure sidebar navigation with meta.json files, and verify the complete static build produces working API reference pages with playground and code examples.

Purpose: Completes the developer-facing API reference experience. Without this plan, the generated MDX files from Plan 20-01 have no rendering components and won't display correctly.
Output: Working API reference pages in the static build with interactive playground, code examples, and sidebar navigation.
</objective>

<execution_context>
@/Users/kyle/.claude/get-shit-done/workflows/execute-plan.md
@/Users/kyle/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/20-openapi-integration-api-reference/20-RESEARCH.md
@.planning/phases/20-openapi-integration-api-reference/20-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create API page components, update MDX registration, and add OpenAPI CSS</name>
  <files>
    apps/docs/components/api-page.tsx
    apps/docs/components/api-page.client.tsx
    apps/docs/mdx-components.tsx
    apps/docs/tailwind.css
    apps/docs/app/docs/[[...slug]]/page.tsx
  </files>
  <action>
1. Create `apps/docs/components/api-page.tsx` (server component):
   ```typescript
   import { openapi } from '@/lib/openapi';
   import { createAPIPage } from 'fumadocs-openapi/ui';
   import client from './api-page.client';

   export const APIPage = createAPIPage(openapi, { client });
   ```

2. Create `apps/docs/components/api-page.client.tsx` (client component):
   ```typescript
   'use client';
   import { defineClientConfig } from 'fumadocs-openapi/ui/client';

   export default defineClientConfig({
     storageKeyPrefix: 'viewroyal-api',
   });
   ```

3. Update `apps/docs/mdx-components.tsx` to register APIPage:
   ```typescript
   import defaultComponents from 'fumadocs-ui/mdx';
   import { APIPage } from '@/components/api-page';
   import type { MDXComponents } from 'mdx/types';

   export function useMDXComponents(components: MDXComponents): MDXComponents {
     return {
       ...defaultComponents,
       APIPage,
       ...components,
     };
   }
   ```

4. Update `apps/docs/tailwind.css` to add the fumadocs-openapi CSS preset and source directive:
   ```css
   @import 'tailwindcss';
   @import 'fumadocs-ui/css/neutral.css';
   @import 'fumadocs-ui/css/preset.css';
   @import 'fumadocs-openapi/css/preset.css';
   @source '../node_modules/fumadocs-ui/dist/**/*.js';
   @source '../node_modules/fumadocs-openapi/dist/**/*.js';
   ```

5. Update `apps/docs/app/docs/[[...slug]]/page.tsx` to pass the APIPage component via mdxComponents. The current page.tsx passes `defaultMdxComponents` directly. It should import from the root `mdx-components.tsx` instead, or merge APIPage into the components passed to MDX. The simplest approach is to import and spread useMDXComponents:
   ```typescript
   import { useMDXComponents } from '@/mdx-components';
   // In the render:
   <MDX components={{ ...useMDXComponents({}) }} />
   ```
   This ensures generated MDX files that use `<APIPage />` can resolve the component.

IMPORTANT: The generated MDX files from Plan 20-01 use `<APIPage />` as an MDX component. If this component is not registered in mdx-components.tsx AND properly passed in the page.tsx render, the pages will fail to render. Both registrations are needed.

NOTE on server/client boundary: `api-page.tsx` is a server component (no 'use client'). `api-page.client.tsx` has 'use client'. Never cross-import server modules into client modules. The `createAPIPage` function from `fumadocs-openapi/ui` handles the boundary internally.
  </action>
  <verify>
    <automated>cd /Users/kyle/development/viewroyal/apps/docs && test -f components/api-page.tsx && test -f components/api-page.client.tsx && grep -q "APIPage" mdx-components.tsx && grep -q "fumadocs-openapi/css/preset.css" tailwind.css</automated>
    <manual>Inspect components for correct server/client split. Verify mdx-components.tsx exports APIPage. Verify tailwind.css has openapi CSS import and source directive.</manual>
  </verify>
  <done>
    - api-page.tsx server component exists and imports openapi + client config
    - api-page.client.tsx client component exists with 'use client' directive
    - mdx-components.tsx registers APIPage
    - tailwind.css includes fumadocs-openapi CSS preset and source directive
    - page.tsx passes APIPage through MDX components
  </done>
</task>

<task type="auto">
  <name>Task 2: Configure sidebar navigation meta.json files and verify full static build</name>
  <files>
    apps/docs/content/docs/meta.json
    apps/docs/content/docs/api-reference/meta.json
  </files>
  <action>
1. Update `apps/docs/content/docs/meta.json` to add the API Reference section:
   ```json
   {
     "root": true,
     "pages": [
       "---Getting Started---",
       "...",
       "---API Reference---",
       "api-reference"
     ]
   }
   ```

2. Create `apps/docs/content/docs/api-reference/meta.json` for tag group ordering. The exact tag names depend on what the OpenAPI spec produces. Check the generated directory names in `content/docs/api-reference/` from Plan 20-01 and list them in the desired sidebar order. Expected tags based on the chanfana routes: meetings, people, matters, motions, bylaws, search, ocd, system. Create the meta.json with these tag folders:
   ```json
   {
     "title": "API Reference",
     "pages": [
       "meetings",
       "people",
       "matters",
       "motions",
       "bylaws",
       "search",
       "ocd",
       "system"
     ]
   }
   ```
   IMPORTANT: The directory names MUST match exactly what `generateFiles()` produced. List the actual directories in `content/docs/api-reference/` and use those names. Tag names may be lowercase, kebab-case, or as-is from the spec -- use the actual folder names.

3. Also create meta.json files for each tag subdirectory if needed for operation ordering within a tag group. Check if the generated MDX files have sensible default ordering. If not, create a meta.json in each tag folder listing the operation MDX files in logical order (e.g., list before get-by-id, create before update before delete).

4. Run the full build to verify everything works end-to-end:
   ```bash
   cd /Users/kyle/development/viewroyal/apps/docs && pnpm build
   ```
   The build should:
   - Run the prebuild script (fetch spec + generate MDX)
   - Compile all pages including generated API reference pages
   - Produce a static `out/` directory with API reference HTML files
   - Complete with zero errors

5. If the build fails:
   - Check for import errors (server/client boundary violations)
   - Check for missing component registrations
   - Check if generated MDX files reference components not in mdx-components.tsx
   - Check if meta.json folder names don't match generated directories
   Fix any issues and re-run the build.

6. After a successful build, verify the output:
   - Check that `out/` contains HTML files for API reference pages
   - The HTML should contain rendered endpoint information (not just raw MDX)
  </action>
  <verify>
    <automated>cd /Users/kyle/development/viewroyal/apps/docs && node scripts/generate-openapi.mjs && pnpm build 2>&1 | tail -20</automated>
    <manual>Open out/docs/api-reference/ in a browser. Verify sidebar shows API Reference with tag groups. Verify endpoint pages show playground and code examples.</manual>
  </verify>
  <done>
    - Root meta.json includes API Reference section
    - api-reference/meta.json orders tag groups correctly
    - `pnpm build` completes with zero errors
    - Static out/ directory contains API reference HTML pages
    - Sidebar navigation shows all API tag groups
  </done>
</task>

</tasks>

<verification>
1. `pnpm --filter docs build` completes with zero errors
2. API reference pages visible in sidebar under "API Reference" heading
3. Each endpoint page renders with endpoint details, interactive playground, and 3-language code examples
4. Static out/ directory contains HTML for all API reference routes
5. Server/client component boundary is correct (no RSC violations)
</verification>

<success_criteria>
- Full static build succeeds with API reference pages included
- Sidebar shows API Reference section with tag group navigation (Meetings, People, etc.)
- API reference pages display endpoint details, playground, and code examples in curl/JS/Python
- No server/client component boundary violations
</success_criteria>

<output>
After completion, create `.planning/phases/20-openapi-integration-api-reference/20-02-SUMMARY.md`
</output>
