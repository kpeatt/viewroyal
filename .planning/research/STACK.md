# Technology Stack: v1.4 Developer Documentation Portal

**Project:** ViewRoyal.ai v1.4 â€” fumadocs.dev Documentation Site
**Researched:** 2026-02-23
**Scope:** New dependencies for a fumadocs-powered developer documentation portal at docs.viewroyal.ai, deployed as a separate Cloudflare Worker alongside the existing React Router 7 app.
**Out of scope:** Existing stack (React Router 7, Tailwind 4, Hono + chanfana, Supabase, Cloudflare Workers for apps/web/) -- all validated and unchanged.

---

## Deployment Strategy Decision

### Static Export to Cloudflare Workers (RECOMMENDED)

Use Next.js `output: 'export'` to build the docs site as pure static HTML/CSS/JS, deployed as a Cloudflare Worker with static assets. This is the simplest, cheapest, and most reliable path for a documentation site.

**Why static export over OpenNext (@opennextjs/cloudflare):**
- A documentation site has zero dynamic server-side logic at runtime -- all content is known at build time
- Static export produces a `./out/` folder of HTML files -- no Worker runtime code, no Node.js compatibility shims, no edge runtime concerns
- Fumadocs explicitly documents that `output: 'export'` works, including with the OpenAPI integration (pages are pre-rendered via `generateStaticParams`)
- OpenNext adds complexity (build transforms, `open-next.config.ts`, `WORKER_SELF_REFERENCE` binding, `.open-next/` output) that is unnecessary when the site has no server-side routes
- Static assets on Cloudflare Workers are free (no billable Worker invocations for asset-only requests)

**Why NOT Cloudflare Pages:** Pages was deprecated by Cloudflare in April 2025. The recommended path for static sites is now Workers with static assets, configured via `[assets]` in `wrangler.toml`.

**Why NOT React Router (fumadocs supports it):** While fumadocs v16 added React Router support, the OpenAPI integration (`fumadocs-openapi`) requires React Server Components. RSC is available in Next.js but not in React Router 7. The OpenAPI auto-generated API reference is a core feature of this milestone, so Next.js is required.

**Confidence:** HIGH -- fumadocs static export docs, Cloudflare Workers static assets docs, Next.js static export docs all confirm this works.

---

## Recommended Stack

### Core Framework

| Technology | Version | Purpose | Why |
|------------|---------|---------|-----|
| next | ^16.1.5 | React framework for docs site | fumadocs-ui v16 requires `next: 16.x.x`. Next.js 16 is the current stable release (16.1.6 as of today). Required for RSC support which fumadocs-openapi needs. |
| react | ^19.2.0 | UI rendering | Required by fumadocs v16 (minimum 19.2.0). |
| react-dom | ^19.2.0 | DOM rendering | Required by fumadocs v16 (minimum 19.2.0). |

**Note on Next.js 16 vs 15:** fumadocs-ui v16.6.x has a hard peer dependency on `next: 16.x.x`. Next.js 15 is not supported. This is a deliberate fumadocs decision tied to React 19.2 features and the removal of Turbopack/SWC compatibility issues.

**Confidence:** HIGH -- verified via `npm view fumadocs-ui@16.6.5 peerDependencies`.

---

### Documentation Framework

| Technology | Version | Purpose | Why |
|------------|---------|---------|-----|
| fumadocs-core | ^16.6.5 | Core docs engine: source loading, page trees, search indexing, navigation | Framework-agnostic engine. Handles content ingestion, builds the navigation tree from file structure + `meta.json`, provides search via built-in Orama. |
| fumadocs-ui | ^16.6.5 | Pre-built UI components: DocsLayout, DocsPage, sidebar, TOC, breadcrumbs, code blocks | Beautiful, accessible docs UI out of the box. Uses Radix UI internally. Tailwind CSS v4 native. Includes dark mode via next-themes. |
| fumadocs-mdx | ^14.2.8 | MDX compilation plugin for Next.js | Compiles MDX content at build time, extracts frontmatter, generates table-of-contents, produces type-safe page collections in `.source/` directory. Integrates via `createMDX()` wrapper in `next.config.mjs`. |
| fumadocs-openapi | ^10.3.9 | Auto-generates API reference pages from OpenAPI 3.1 spec | Reads the existing `/api/v1/openapi.json` spec (or a local copy), generates MDX page stubs, renders interactive API documentation via `APIPage` RSC component. Includes playground, code samples, schema browser. |

**Confidence:** HIGH -- all versions verified via npm registry on 2026-02-23.

---

### OpenAPI Integration

| Technology | Version | Purpose | Why |
|------------|---------|---------|-----|
| fumadocs-openapi | ^10.3.9 | See above | Renders API reference from the existing chanfana-generated OpenAPI 3.1 spec. |
| shiki | ^3.22.0 | Syntax highlighting for code blocks and API examples | Required peer dependency of fumadocs-openapi. Also used by fumadocs-core for general code highlighting. Already uses the JS regex engine (not WASM Oniguruma) for Cloudflare compatibility. |

**Integration with existing OpenAPI spec:**

The existing app serves `GET /api/v1/openapi.json` (auto-generated by chanfana). The docs site will consume this spec in one of two ways:

1. **Build-time fetch (recommended):** A pre-build script fetches the live spec and saves it locally:
   ```bash
   curl https://viewroyal.ai/api/v1/openapi.json > content/openapi/api-v1.json
   ```
   Then `createOpenAPI({ input: ['./content/openapi/api-v1.json'] })` points to the local file.

2. **Direct URL reference:** `createOpenAPI({ input: ['https://viewroyal.ai/api/v1/openapi.json'] })` fetches at build time. Works but couples build to production being up.

Option 1 is better because it makes builds reproducible and allows the spec to be committed to the repo (versioned alongside the docs).

**What fumadocs-openapi generates:**
- One MDX page per API endpoint (grouped by tag)
- Interactive request playground (client-side, no server needed)
- Multi-language code examples (curl, JavaScript, Python)
- TypeScript type definitions from response schemas
- Request/response parameter tables from Zod schemas

**Confidence:** HIGH -- verified via fumadocs OpenAPI docs and npm package inspection.

---

### MDX Tooling

| Technology | Version | Purpose | Why |
|------------|---------|---------|-----|
| @types/mdx | ^2.0.13 | TypeScript types for MDX files | Required by fumadocs-mdx for type-safe MDX imports. |

**Content pipeline (how MDX files become pages):**

1. Author writes `.mdx` files in `content/docs/`
2. `fumadocs-mdx` compiles them at dev/build time via `createMDX()` Next.js plugin
3. Output goes to `.source/` directory (gitignored) with type-safe collection exports
4. `lib/source.ts` creates a fumadocs `loader()` that builds the page tree
5. App Router `[...slug]/page.tsx` catches all routes, looks up the page, renders with `<DocsPage>`

**MDX features available:**
- GitHub Flavored Markdown (remark-gfm bundled in fumadocs-core)
- Code blocks with syntax highlighting (shiki, bundled)
- Callouts/admonitions via fumadocs-ui components
- Tabs, accordions, cards (fumadocs-ui includes these)
- Custom MDX components via `mdx-components.tsx`
- Frontmatter with title, description, icon fields

---

### Styling

| Technology | Version | Purpose | Why |
|------------|---------|---------|-----|
| tailwindcss | ^4.0.0 | CSS framework | Required by fumadocs-ui. Same major version as the existing web app (^4.1.13). |
| @tailwindcss/vite | N/A | NOT NEEDED | The docs site uses Next.js, not Vite. Tailwind v4 with Next.js uses PostCSS or the `@next/tailwindcss` integration. |

**Tailwind CSS v4 configuration for fumadocs (CSS-first, no tailwind.config.js):**

```css
/* app/global.css */
@import 'tailwindcss';
@import 'fumadocs-ui/css/neutral.css';   /* Color palette */
@import 'fumadocs-ui/css/preset.css';    /* Required plugins & styles */
@import 'fumadocs-openapi/css/preset.css'; /* OpenAPI component styles */
@source '../node_modules/fumadocs-ui/dist/**/*.js';
```

No `tailwind.config.js` file needed. fumadocs-ui v15+ uses Tailwind v4's CSS-first configuration exclusively.

**Confidence:** HIGH -- verified via fumadocs v15 blog post and `npm view @fumadocs/tailwind peerDependencies`.

---

### Search

| Technology | Version | Purpose | Why |
|------------|---------|---------|-----|
| @orama/orama | (bundled) | Client-side full-text search | Bundled in fumadocs-core. For static export, search indexes are generated at build time as JSON files, downloaded by clients, and queried in-browser. No server needed. |

**Static search configuration:**
- fumadocs generates search indexes during `next build`
- Indexes are included in the static `out/` folder
- Client loads indexes on first search interaction
- For a docs site of this size (estimated 50-100 pages), client-side search is fast and appropriate
- No Algolia or Orama Cloud subscription needed

**Confidence:** HIGH -- fumadocs static export docs explicitly describe this workflow.

---

### Deployment

| Technology | Version | Purpose | Why |
|------------|---------|---------|-----|
| wrangler | ^4.65.0 | Deploy static assets to Cloudflare Workers | Same tool used by apps/web/ and apps/vimeo-proxy/. Deploys the `out/` folder as static assets. |

**wrangler.toml for apps/docs/:**

```toml
name = "viewroyal-docs"
compatibility_date = "2026-02-23"

[assets]
directory = "./out"
not_found_handling = "404-page"
html_handling = "auto-trailing-slash"
```

**next.config.mjs for static export:**

```js
import { createMDX } from 'fumadocs-mdx/next';

const config = {
  output: 'export',
  trailingSlash: true,
  images: { unoptimized: true },
};

export default createMDX()(config);
```

**Custom domain:** `docs.viewroyal.ai` set via Cloudflare dashboard (wrangler CLI does not support custom domain management). This is a separate Worker from the main `viewroyal-web` Worker.

**Build + deploy scripts (apps/docs/package.json):**

```json
{
  "scripts": {
    "dev": "next dev",
    "prebuild": "node scripts/fetch-openapi.mjs",
    "build": "next build",
    "deploy": "next build && wrangler deploy"
  }
}
```

**Confidence:** HIGH -- Cloudflare Workers static assets docs, verified configuration options.

---

## Monorepo Configuration

### Current State

The repository has NO root-level `pnpm-workspace.yaml` or `package.json`. Each app (`apps/web/`, `apps/vimeo-proxy/`) manages its own dependencies independently. The `pnpm-workspace.yaml` inside `apps/web/` contains only `packages: ["."]`.

### Recommended Approach: Keep Independent

Do NOT create a root-level pnpm workspace. Keep `apps/docs/` as a self-contained Next.js project with its own `package.json`, `node_modules/`, and `pnpm-workspace.yaml`.

**Why:**
- The existing apps work this way. Consistency matters.
- Next.js and React Router 7 have different React version pinning strategies (Next.js uses its own React canary channel). Sharing `node_modules` between them causes version conflicts.
- Independent apps deploy independently -- `apps/docs/` can build and deploy without touching `apps/web/`.
- No risk of `pnpm install` in one app breaking another.

**New file structure:**

```
apps/
  docs/                    # NEW: fumadocs documentation site
    app/                   #   Next.js App Router pages
      layout.tsx           #   Root layout with DocsLayout
      docs/                #   /docs/* routes
        [[...slug]]/       #   Catch-all for docs pages
          page.tsx         #   Page component
      api-reference/       #   /api-reference/* routes
        [[...slug]]/       #   Catch-all for OpenAPI pages
          page.tsx
    content/               #   MDX content
      docs/                #   Hand-written docs (guides, data model, etc.)
        index.mdx          #   Landing page
        getting-started/
        authentication/
        data-model/
        changelog.mdx
      openapi/             #   OpenAPI spec (fetched at build time)
        api-v1.json
    components/            #   Custom components
      api-page.tsx         #   OpenAPI page wrapper (RSC)
      api-page.client.tsx  #   OpenAPI client config
    lib/                   #   Source loaders
      source.ts            #   Fumadocs source configuration
      openapi.ts           #   OpenAPI instance
    scripts/               #   Build scripts
      fetch-openapi.mjs    #   Pre-build: fetch latest OpenAPI spec
    public/                #   Static assets (favicon, etc.)
    source.config.ts       #   Fumadocs MDX collection config
    next.config.mjs        #   Next.js config with fumadocs-mdx plugin
    wrangler.toml          #   Cloudflare Workers deployment config
    tsconfig.json
    package.json
    pnpm-workspace.yaml    #   packages: ["."]
    .gitignore             #   .source/, .next/, out/, node_modules/
  web/                     # EXISTING: React Router 7 app (unchanged)
  vimeo-proxy/             # EXISTING: Cloudflare Worker (unchanged)
  pipeline/                # EXISTING: Python ETL (unchanged)
```

**Confidence:** HIGH -- matches existing monorepo pattern.

---

## Alternatives Considered

| Category | Recommended | Alternative | Why Not |
|----------|-------------|-------------|---------|
| Docs framework | fumadocs | Nextra | Nextra v4 is beta; fumadocs is stable, has better OpenAPI integration, and is actively maintained |
| Docs framework | fumadocs | Docusaurus | React 19 support unclear; no built-in OpenAPI rendering; heavier bundle |
| Docs framework | fumadocs | Starlight (Astro) | Would introduce Astro as a third framework. Excellent but adds ecosystem complexity. fumadocs stays in the React/Next.js family. |
| Docs framework | fumadocs | VitePress | Vue-based. The existing codebase is 100% React/TypeScript. |
| Deployment | Static export + Workers | OpenNext | OpenNext adds runtime complexity unnecessary for a static docs site. Reserve for apps with server-side logic. |
| Deployment | Static export + Workers | Vercel | Adds another hosting provider. Cloudflare is already the deployment target for everything else. |
| Deployment | Static export + Workers | Cloudflare Pages | Deprecated April 2025. Workers with static assets is the replacement. |
| OpenAPI rendering | fumadocs-openapi | Scalar standalone | Scalar is excellent standalone but fumadocs-openapi integrates natively -- same sidebar, search, navigation. No iframe or separate app. |
| OpenAPI rendering | fumadocs-openapi | Swagger UI standalone | Already served at /api/v1/docs. The fumadocs integration is richer (playground, code samples, schema browser). |
| Monorepo | Independent apps | Root pnpm workspace | Risk of React version conflicts between Next.js 16 and React Router 7. Not worth the coupling. |

---

## What NOT to Add

| Technology | Why Not |
|------------|---------|
| @opennextjs/cloudflare | Unnecessary for a static export docs site. Adds build complexity with no benefit. |
| Vercel | Extra hosting provider. Cloudflare already handles everything. |
| Algolia / Orama Cloud | Overkill for a docs site with ~50-100 pages. Built-in static Orama search is sufficient and free. |
| @next/bundle-analyzer | Premature optimization. Add later if bundle size becomes an issue. |
| next-sitemap | Static export can include a sitemap via `generateStaticParams`. Or add later with a simple build script. |
| contentlayer | Deprecated. fumadocs-mdx is the content layer. |
| mdx-bundler | fumadocs-mdx handles MDX compilation. |
| nextra | Different framework. fumadocs was chosen for its OpenAPI integration. |
| turbopack | Next.js 16 includes it by default for dev. No explicit dependency needed. |
| Any database dependencies | The docs site is 100% static. No Supabase client needed. |
| Any auth dependencies | Public documentation. No login required. |

---

## Installation Summary

```bash
# Create the docs app directory
mkdir -p apps/docs && cd apps/docs

# Initialize
pnpm init

# Core framework
pnpm add next@^16.1.5 react@^19.2.0 react-dom@^19.2.0

# Fumadocs
pnpm add fumadocs-core@^16.6.5 fumadocs-ui@^16.6.5 fumadocs-mdx@^14.2.8 fumadocs-openapi@^10.3.9

# Required peer dependencies
pnpm add shiki@^3.22.0

# Dev dependencies
pnpm add -D @types/react@^19.2.0 @types/react-dom@^19.2.0 @types/mdx@^2.0.13 typescript@^5.9.2 wrangler@^4.65.0 tailwindcss@^4.0.0
```

**Total: 7 production dependencies, 6 dev dependencies.** No overlap with `apps/web/` -- fully independent.

---

## Version Compatibility Matrix

| Dependency | Version | Requires | Verified |
|------------|---------|----------|----------|
| fumadocs-core | ^16.6.5 | react >=19.2.0, next 16.x.x | Yes (npm view) |
| fumadocs-ui | ^16.6.5 | react >=19.2.0, next 16.x.x, fumadocs-core 16.6.5 | Yes (npm view) |
| fumadocs-mdx | ^14.2.8 | fumadocs-core >=15.0.0, next >=15.3.0 | Yes (npm view) |
| fumadocs-openapi | ^10.3.9 | fumadocs-core >=16.5.0, fumadocs-ui >=16.5.0, react >=19.2.0 | Yes (npm view) |
| next | ^16.1.5 | react >=19.0.0, node >=20.9.0 | Yes (npm view) |
| shiki | ^3.22.0 | none (standalone) | Yes |
| tailwindcss | ^4.0.0 | none (standalone) | Yes |
| wrangler | ^4.65.0 | none | Yes |
| typescript | ^5.9.2 | none | Yes (same as apps/web/) |
| Node.js | >=20.9.0 | -- | Yes (system has v25.3.0) |

---

## Configuration Files Summary

| File | Purpose |
|------|---------|
| `source.config.ts` | Define MDX content collections (docs dir, frontmatter schema) |
| `next.config.mjs` | Static export + fumadocs-mdx plugin |
| `tsconfig.json` | TypeScript config with fumadocs-mdx path alias |
| `wrangler.toml` | Cloudflare Workers static asset deployment |
| `app/global.css` | Tailwind v4 imports + fumadocs presets |
| `lib/source.ts` | Fumadocs source loader (page tree builder) |
| `lib/openapi.ts` | OpenAPI instance pointing to local spec file |
| `mdx-components.tsx` | MDX component overrides (APIPage, custom components) |
| `pnpm-workspace.yaml` | `packages: ["."]` (self-contained workspace) |

---

## Risk Assessment

| Risk | Likelihood | Impact | Mitigation |
|------|-----------|--------|------------|
| fumadocs v16 peer dep on Next.js 16 breaks with Next.js 16.2+ | Low | Medium | Pin to `^16.1.5` (tilde range in fumadocs ensures compatibility). fumadocs releases track Next.js closely. |
| OpenAPI APIPage fails with `output: 'export'` | Low | High | APIPage uses RSC which renders at build time with static export. `generateStaticParams` ensures all pages are pre-rendered. If issues arise, fall back to `generateFiles()` MDX-only approach. |
| Static search indexes too large for client download | Low | Low | ~50-100 pages will produce small indexes. If needed, switch to Orama Cloud later. |
| Tailwind v4 style conflicts between fumadocs and custom styles | Low | Low | fumadocs uses its own CSS custom properties (`--fd-*`). Isolated by CSS specificity. |
| Build-time OpenAPI spec fetch fails (production down) | Medium | Low | Commit the spec to the repo. `prebuild` script updates it; build still works with stale copy. |
| wrangler static assets config quirks (404 handling, trailing slashes) | Low | Medium | `html_handling: auto-trailing-slash` + `not_found_handling: 404-page` matches Next.js static export conventions. Test in preview before production deploy. |

---

## Sources

### HIGH Confidence (Official docs, first-party, npm registry)
- [fumadocs.dev - OpenAPI integration](https://www.fumadocs.dev/docs/integrations/openapi) -- Setup, APIPage, generateFiles
- [fumadocs.dev - Static Build](https://www.fumadocs.dev/docs/deploying/static) -- output: 'export' configuration
- [fumadocs.dev - Deployment](https://www.fumadocs.dev/docs/deploying) -- "Use opennext.js.org/cloudflare, Fumadocs doesn't work on Edge runtime"
- [fumadocs.dev - v16 blog post](https://www.fumadocs.dev/blog/v16) -- Breaking changes, Next.js 16 requirement, Cloudflare JS engine default
- [fumadocs.dev - MDX setup for Next.js](https://www.fumadocs.dev/docs/mdx/next) -- source.config.ts, next.config.mjs, lib/source.ts
- [npm: fumadocs-core@16.6.5](https://www.npmjs.com/package/fumadocs-core) -- Peer deps verified via `npm view`
- [npm: fumadocs-ui@16.6.5](https://www.npmjs.com/package/fumadocs-ui) -- Peer deps: next 16.x.x, react >=19.2.0
- [npm: fumadocs-openapi@10.3.9](https://www.npmjs.com/package/fumadocs-openapi) -- Dependencies, peer deps
- [npm: fumadocs-mdx@14.2.8](https://www.npmjs.com/package/fumadocs-mdx) -- Peer deps: next >=15.3.0, vite 6-7
- [npm: next@16.1.6](https://www.npmjs.com/package/next) -- Peer deps, engine requirements
- [Cloudflare Workers Static Assets](https://developers.cloudflare.com/workers/static-assets/) -- Configuration, deployment
- [Cloudflare Workers SSG routing](https://developers.cloudflare.com/workers/static-assets/routing/static-site-generation/) -- html_handling, not_found_handling
- [OpenNext Cloudflare - Get Started](https://opennext.js.org/cloudflare/get-started) -- Configuration reference (evaluated but NOT recommended for this use case)
- [GitHub: fuma-nama/fumadocs](https://github.com/fuma-nama/fumadocs) -- 1,505 releases, actively maintained

### MEDIUM Confidence (Multiple credible sources agree)
- [Deploy Next.js 16 + Fumadocs to GitHub Pages](https://zephinax.com/blog/deploy-nextjs-fumadocs-github-pages) -- Confirms static export workflow with trailingSlash, images.unoptimized
- [DeepWiki: fumadocs architecture](https://deepwiki.com/fuma-nama/fumadocs) -- Build pipeline description, layered architecture
- [fumadocs Tailwind v4 discussion](https://github.com/fuma-nama/fumadocs/discussions/1338) -- Community confirms CSS-first config

### LOW Confidence (Single source, needs validation during implementation)
- Cloudflare Pages deprecation date (April 2025) -- referenced in community posts but not in official deprecation announcement
- Static search performance for OpenAPI-generated pages -- untested at scale with API reference content

---
*Last updated: 2026-02-23*
